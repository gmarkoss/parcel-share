# ‚úÖ ParcelShare Deployment Checklist

## üéØ Deployment Target: Render (Backend) + Vercel (Frontend)

### Pre-Deployment Checklist

- [x] All code committed to Git
- [x] GitHub repository configured: `git@github.com:gmarkoss/parcel-share.git`
- [x] CORS configured for production
- [x] Environment variables prepared
- [x] Production build scripts ready
- [x] Database schema ready (TypeORM auto-sync in dev)
- [ ] Deploy to Render (Backend)
- [ ] Deploy to Vercel (Frontend)
- [ ] Test live application

---

## üì¶ Step 1: Push to GitHub

```bash
# Add all changes
git add .

# Commit with descriptive message
git commit -m "Ready for deployment: Production configs, CORS updates, and deployment guide"

# Push to GitHub
git push origin main
```

**Status**: ‚úÖ Ready to push

---

## üöÄ Step 2: Deploy Backend on Render

### 2.1 Create Account
1. Go to [render.com](https://render.com)
2. Sign up with GitHub
3. Allow Render to access your repositories

### 2.2 Create PostgreSQL Database
1. Click "New +" ‚Üí "PostgreSQL"
2. Name: `parcel-share-db`
3. Database Name: `parcel_sharing`
4. Region: Choose closest to your users
5. Click "Create Database"
6. **Save the connection details!**

### 2.3 Deploy Web Service
1. Click "New +" ‚Üí "Web Service"
2. Connect your GitHub repository: `gmarkoss/parcel-share`
3. Configure the service:
   - **Name**: `parcel-share-backend`
   - **Region**: Same as database
   - **Branch**: `main`
   - **Root Directory**: `backend`
   - **Runtime**: `Node`
   - **Build Command**: `npm install && npm run build`
   - **Start Command**: `npm run start:prod`

### 2.4 Environment Variables
Add these in Render Dashboard ‚Üí Environment:

```env
# Database (Render provides these automatically)
DATABASE_URL=<auto-generated-by-render>

# Or manually set these:
DB_HOST=<from-psql-info>
DB_PORT=5432
DB_USERNAME=<from-psql-info>
DB_PASSWORD=<from-psql-info>
DB_DATABASE=parcel_sharing

# JWT
JWT_SECRET=<generate-a-random-secret-here>
JWT_EXPIRES_IN=7d

# Server
NODE_ENV=production
PORT=10000

# Frontend URL (will update after Vercel deploy)
FRONTEND_URL=https://your-app.vercel.app
```

### 2.5 Deploy and Test
1. Click "Create Web Service"
2. Wait for deployment (5-10 minutes)
3. Get your backend URL: `https://parcel-share-backend.onrender.com`
4. Test API: `https://parcel-share-backend.onrender.com/api`

**Expected Response**:
```json
{"message":"Cannot GET /api"}
```
This is normal - the root endpoint doesn't exist.

5. Test Swagger Docs: `https://parcel-share-backend.onrender.com/api/docs`
6. Test signup endpoint:
   ```bash
   curl -X POST https://parcel-share-backend.onrender.com/api/auth/signup \
     -H "Content-Type: application/json" \
     -d '{"email":"test@example.com","password":"test123","name":"Test User","phone":"+1234567890"}'
   ```

---

## üé® Step 3: Deploy Frontend on Vercel

### 3.1 Create Account
1. Go to [vercel.com](https://vercel.com)
2. Sign up with GitHub
3. Import your repository: `gmarkoss/parcel-share`

### 3.2 Configure Project
1. **Project Name**: `parcel-share`
2. **Framework Preset**: Next.js
3. **Root Directory**: `frontend`
4. **Build Command**: `npm run build` (auto-detected)
5. **Output Directory**: `.next`

### 3.3 Environment Variables
Add this in Vercel Dashboard:

```env
NEXT_PUBLIC_API_URL=https://parcel-share-backend.onrender.com/api
```

### 3.4 Deploy
1. Click "Deploy"
2. Wait for build (2-5 minutes)
3. Get your frontend URL: `https://parcel-share-xxx.vercel.app`

---

## üîÑ Step 4: Update Backend CORS

Now that you have the Vercel URL, update backend CORS:

### On Render Dashboard:
1. Go to your web service
2. Environment tab
3. Update `FRONTEND_URL` with your Vercel URL:
   ```
   https://parcel-share-xxx.vercel.app
   ```
4. Manual deploy (or trigger redeploy)

**Or update the code and push**:

Edit `backend/src/main.ts`:
```typescript
const allowedOrigins = [
  'http://localhost:3000',
  'http://localhost:3002',
  process.env.FRONTEND_URL,
  'https://parcel-share-xxx.vercel.app',  // Add your Vercel URL here
].filter(Boolean);
```

Push to GitHub - Render will auto-redeploy.

---

## ‚úÖ Step 5: Final Testing

### Test Complete Flow

1. **Visit Frontend**: `https://parcel-share-xxx.vercel.app`
2. **Sign Up**: Create a test account
3. **Create Parcel**: Post a delivery request
4. **Create Trip**: Offer a trip
5. **View Matches**: Check matching functionality
6. **Check Notifications**: Verify event-driven notifications

### Expected Results

- ‚úÖ User can sign up and sign in
- ‚úÖ Parcels can be created
- ‚úÖ Trips can be created
- ‚úÖ Matching algorithm works
- ‚úÖ Notifications appear
- ‚úÖ API is accessible via Swagger docs

---

## üêõ Troubleshooting

### Issue: Database Connection Error

**Solution**: 
- Check environment variables in Render
- Verify DATABASE_URL is correct
- Ensure PostgreSQL service is running

### Issue: CORS Error

**Solution**:
- Verify `FRONTEND_URL` in Render matches your Vercel URL
- Check browser console for exact error
- Update CORS origins in backend

### Issue: Build Fails

**Solution**:
- Check build logs in Render dashboard
- Verify all dependencies are in package.json
- Ensure build command is correct

### Issue: 502 Bad Gateway

**Solution**:
- Check if service is sleeping (Render free tier)
- Wait 30 seconds for cold start
- Consider upgrading to paid plan

---

## üí∞ Cost Breakdown

| Service | Plan | Monthly Cost |
|---------|------|-------------|
| Render PostgreSQL | Free | $0 |
| Render Web Service | Free | $0 |
| Vercel (Frontend) | Free | $0 |
| **Total** | | **$0/month** |

**Limitations**:
- Render services may spin down after 15min inactivity
- Cold starts can take 30-60 seconds
- Unlimited deployments on both platforms

---

## üìä Performance Expectations

### Render (Backend)
- **Cold Start**: 30-60 seconds (first request after idle)
- **Warm Response**: < 200ms
- **API Latency**: 100-300ms

### Vercel (Frontend)
- **First Load**: < 2 seconds (CDN cached)
- **Subsequent Loads**: < 500ms
- **API Calls**: Global edge network

### Database
- **Connection Time**: < 100ms
- **Query Time**: < 50ms (for simple queries)
- **PostgreSQL**: Fully managed

---

## üîí Security Checklist

- [x] JWT authentication implemented
- [x] Password hashing with bcrypt
- [x] CORS protection enabled
- [x] Input validation with class-validator
- [x] HTTPS/SSL automatic (both platforms)
- [x] Environment variables secured
- [ ] Rate limiting (consider adding)
- [ ] Request logging (consider adding)

---

## üéâ Deployment Complete!

Once deployed, your app will be accessible at:
- **Frontend**: `https://parcel-share-xxx.vercel.app`
- **Backend API**: `https://parcel-share-backend.onrender.com/api`
- **API Docs**: `https://parcel-share-backend.onrender.com/api/docs`

Share your app with the world! üöÄ

---

## üìù Next Steps After Deployment

1. **Monitor Usage**:
   - Check Render logs
   - Monitor Vercel analytics
   - Track API response times

2. **Set Up Custom Domain** (Optional):
   - Vercel: Add domain in project settings
   - Update FRONTEND_URL in Render
   - SSL automatically configured

3. **Add Monitoring** (Recommended):
   - Sentry for error tracking
   - Vercel Analytics
   - Uptime monitoring

4. **Scale When Needed**:
   - Upgrade Render plan ($7/month) for no sleep
   - Add database backups
   - Implement caching

---

**Good luck with your deployment!** üéâ

If you encounter any issues, check the logs in Render and Vercel dashboards.

